const COOKIE_KEY_EVENT_ID="_axeid",COOKIE_KEY_WRT_SCRIPT_SET="_axwrt",COOKIE_KEY_WRT_HTTP_SET="axwrt",QUERY_PARAM_ALEID="aleid",PIXEL_LOG_ENDPOINT="https://b.applovin.com/v1/log",PIXEL_TYPE="shopify";let _axInitSource="unknown";async function _sendPixelLog(level,message){const logData={pixel_type:"shopify",logs:[{level:level,timestamp:Date.now(),message:`[${_axInitSource}] ${message} url: ${window?.location?.href||"unknown"}`}]};await fetch(PIXEL_LOG_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(logData)})}async function _axGetCurrentCartAleId(){try{const cartResponse=await fetch((window?.Shopify?.routes?.root||"/")+"cart.js"),cartData=await cartResponse.json();return cartData.attributes?._axon_event_id||null}catch(error){return console.error("Error retrieving cart event ID:",error),null}}async function _axValidateAleId(expectedEventId){if(!expectedEventId)return;const currentCartEventId=await _axGetCurrentCartAleId();if(currentCartEventId&&currentCartEventId!==expectedEventId)throw new Error(`Event ID mismatch v2: expected ${expectedEventId}, got ${currentCartEventId}`)}async function _axUpdateCartAttributes(wrt,aleid,maxRetries=3,delay=1e3,attempt=1){try{let attributes={};wrt&&(attributes._axon_client_id=wrt),aleid&&(attributes._axon_event_id=aleid);const response=await fetch((window?.Shopify?.routes?.root||"/")+"cart/update.js",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({attributes:attributes})});if(!response.ok)throw new Error(response.statusText+" "+response.status);const result=await response.json();if(result.errors)throw new Error(result.errors);return aleid&&await _axValidateAleId(aleid),result}catch(error){if(!(attempt<maxRetries))throw await _sendPixelLog("error",error.message),error;setTimeout(async()=>await _axUpdateCartAttributes(wrt,aleid,maxRetries,delay,attempt+1),delay*attempt)}}function _axGetCookie(name){try{const cookie=document.cookie.split("; ").find(row=>row.startsWith(name+"="));return cookie?cookie.split("=")[1]:null}catch(error){return null}}function _axGetLocalStorage(name){try{return window.localStorage.getItem(name)}catch(error){return null}}function _axGetUrlParameter(name){try{return new URLSearchParams(window.location.search).get(name)}catch(error){return null}}function _axGetWrt(){return _axGetCookie("_axwrt")||_axGetCookie("axwrt")||_axGetLocalStorage("_axwrt")||_axGetLocalStorage("axwrt")}function _axGetAleid(){return _axGetUrlParameter("aleid")||_axGetCookie("_axeid")||_axGetLocalStorage("_axeid")}!function(){const init=function(source){_axInitSource=source;const aleid=_axGetAleid(),wrt=_axGetWrt();(aleid||wrt)&&_axUpdateCartAttributes(wrt,aleid)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>init("DOMContentLoaded")):init("immediate")}(),setTimeout(function(){const aleid=_axGetAleid();try{_axValidateAleId(aleid)}catch(error){_sendPixelLog("error","Event ID check failed: "+error.message)}},1e4);